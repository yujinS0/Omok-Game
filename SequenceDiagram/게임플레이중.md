# 시퀀스 다이어그램 

------------------------------

## 오목 게임 중 (자기 차례인 플레이어)
### : 클라이언트에서 StartTimer() 실행 중

```mermaid
sequenceDiagram
	actor Player
	participant Game Server
  participant Redis

alt 돌 두기 요청 시
  Player ->> Game Server: 돌 두기 요청
	Game Server ->> Game Server : playingUserKey 생성
 	Game Server ->> Redis : userGameData 가져오기
	Redis ->> Game Server :  
	  Game Server ->> Redis : GameRoomId로 gameData 가져오기
	  Redis ->> Game Server: 

	Game Server ->> Game Server : 자기 턴 맞는지 확인

	Game Server ->> Redis : 돌 두기 정보 업데이트
	Redis ->> Game Server :  

	Game Server ->> Game Server : 승자 체크 요청
  	alt 승자 존재
  	  Game Server ->> GameDB : 게임 결과 (승/패) 업데이트
  	  GameDB ->> Game Server :   
  	end

  	Game Server ->> Player : 돌두기 성공 + 승자 정보
end

alt 타이머 30초 초과 시
	Player ->> Game Server : 게임 턴 변경 요청
	Game Server ->> Redis : GetCurrentTurn 현재 턴 체크
  	Redis ->> Game Server : 
	  Game Server ->> Game Server : AutoChangeTurn()
	  Game Server ->> Redis : 현재 턴 변경
	  Redis ->> Game Server : GetBoard
	  Game Server ->> Player : Board와 CurrentTurn 정보
  Player ->> Player : StartTurnPollingAsync()
end
```



------------------------------

## 오목 게임 중 (차례 기다리는 플레이어)
### : StartTurnPollingAsync()
```mermaid
sequenceDiagram
	actor Player
	participant Game Server
  	participant Redis

	Player ->> Game Server : 현재 게임 턴 체크 요청
	Game Server ->> Redis : GetCurrentTurn 현재 턴 체크
  Redis ->> Game Server :  
  Game Server ->> Player : CurrentTurnPlayerId 정보

alt 자기 차례면,
  Player ->> Player : StartTimer()
end
  

```




------------------------------
------------------------------

## 오목 게임 중 (자기 차례인 플레이어)
### : 클라이언트에서 StartTimer() 실행 중

```mermaid
sequenceDiagram
	actor 자기차례Player
	participant Game Server
  	participant Redis

	자기차례Player ->> 자기차례Player : 30초 타이머 시작

alt 돌 두기 요청
	자기차례Player ->> 자기차례Player : PutStone()
	자기차례Player ->> Game Server: 돌 두기 요청
	Game Server ->> 자기차례Player :  
	자기차례Player ->> 자기차례Player : StopTimer()
 	자기차례Player ->> 자기차례Player : 승자 확인

  	alt 승자 존재 O
 	자기차례Player ->> 자기차례Player : EndGame()
  	end

  	alt 승자 존재 X
 	자기차례Player ->> 자기차례Player : StartTurnPollingAsync()
  	end
end

alt 타이머 30초 초과 시
	자기차례Player ->> Game Server : 게임 턴 변경 API 요청
	Game Server ->> 자기차례Player :  	
	자기차례Player ->> 자기차례Player : StartTurnPollingAsync()
end
```


------------------------------

## 오목 게임 중 (차례 기다리는 플레이어)
### : StartTurnPollingAsync()
```mermaid
sequenceDiagram
	actor Player
	participant Game Server
  	participant Redis

	Player ->> Game Server : 현재 게임 턴 체크 요청
  	Game Server ->> Player : CurrentTurnPlayerId 정보

	alt 자기 차례면,
	  Player ->> Player : StartTimer()
	end
  

```
